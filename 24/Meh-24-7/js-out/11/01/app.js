import { Exist, Leaf, dom, ef, Browser, root } from "../../meh/index.js";
import { Eval } from "./eval.js";
const browser = new Browser(root, { title: "24-11-01 ." });
const ClockView = (com) => {
    const self = new Exist(com);
    const label = new Leaf.String(com, "---");
    new Clock(self, (now) => {
        label.value = now.toLocaleString();
    });
    return ef.main({
        style: {
            display: "flex",
            flexFlow: "column",
            alignItems: "center",
        }
    }, ef.h1({ style: {} }, label), Eval(self));
};
class Clock extends Exist {
    update;
    timeout = 0;
    constructor(com, update) {
        super(com);
        this.update = update;
        this.next();
    }
    next() {
        if (this.timeout)
            return;
        const now = new Date();
        const msec = now.getTime() % 1000;
        const next = 1000 - msec;
        this.timeout = setTimeout(() => {
            clearTimeout(this.timeout);
            this.timeout = 0;
            this.next();
        }, next);
        this.update(now);
        // log( "Clock", this.timeout, msec, next );
    }
    terminate() {
        if (this.timeout)
            clearTimeout(this.timeout);
        super.terminate();
    }
}
dom.create(root, ClockView(root), "body");
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vdHMtc3JjLzExLzAxL2FwcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQU8sTUFBTSxvQkFBb0IsQ0FBQztBQUM5RSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRWpDLE1BQU0sT0FBTyxHQUFHLElBQUksT0FBTyxDQUFFLElBQUksRUFBRSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsQ0FBRSxDQUFDO0FBRTdELE1BQU0sU0FBUyxHQUFHLENBQUUsR0FBVyxFQUFHLEVBQUU7SUFFbkMsTUFBTSxJQUFJLEdBQUcsSUFBSSxLQUFLLENBQUUsR0FBRyxDQUFFLENBQUM7SUFFOUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFFLEdBQUcsRUFBRSxLQUFLLENBQUUsQ0FBQztJQUU1QyxJQUFJLEtBQUssQ0FFUixJQUFJLEVBQ0osQ0FBRSxHQUFHLEVBQUcsRUFBRTtRQUVULEtBQUssQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3BDLENBQUMsQ0FDRCxDQUFDO0lBRUYsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUViO1FBQ0MsS0FBSyxFQUNMO1lBQ0MsT0FBTyxFQUFFLE1BQU07WUFDZixRQUFRLEVBQUUsUUFBUTtZQUNsQixVQUFVLEVBQUUsUUFBUTtTQUNwQjtLQUNELEVBRUQsRUFBRSxDQUFDLEVBQUUsQ0FBRSxFQUFFLEtBQUssRUFBRSxFQUFJLEVBQUUsRUFBQyxLQUFLLENBQUUsRUFDOUIsSUFBSSxDQUFFLElBQUksQ0FBRSxDQUNaLENBQUM7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLEtBQU0sU0FBUSxLQUFLO0lBSVk7SUFGMUIsT0FBTyxHQUFZLENBQUMsQ0FBQztJQUUvQixZQUFhLEdBQVcsRUFBWSxNQUErQjtRQUVsRSxLQUFLLENBQUUsR0FBRyxDQUFFLENBQUM7UUFGc0IsV0FBTSxHQUFOLE1BQU0sQ0FBeUI7UUFHbEUsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2IsQ0FBQztJQUVTLElBQUk7UUFFYixJQUFJLElBQUksQ0FBQyxPQUFPO1lBQUcsT0FBTztRQUUxQixNQUFNLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3ZCLE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDbEMsTUFBTSxJQUFJLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQztRQUV6QixJQUFJLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FFeEIsR0FBRyxFQUFFO1lBRUosWUFBWSxDQUFFLElBQUksQ0FBQyxPQUFPLENBQUUsQ0FBQztZQUM3QixJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztZQUNqQixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDYixDQUFDLEVBQ0QsSUFBSSxDQUNKLENBQUM7UUFFRixJQUFJLENBQUMsTUFBTSxDQUFFLEdBQUcsQ0FBRSxDQUFDO1FBRW5CLDRDQUE0QztJQUM3QyxDQUFDO0lBRWUsU0FBUztRQUV4QixJQUFJLElBQUksQ0FBQyxPQUFPO1lBQUcsWUFBWSxDQUFFLElBQUksQ0FBQyxPQUFPLENBQUUsQ0FBQztRQUNoRCxLQUFLLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbkIsQ0FBQztDQUNEO0FBRUQsR0FBRyxDQUFDLE1BQU0sQ0FBRSxJQUFJLEVBQUUsU0FBUyxDQUFFLElBQUksQ0FBRSxFQUFFLE1BQU0sQ0FBRSxDQUFDIn0=