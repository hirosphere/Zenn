import { _set_value_ } from "../common.js";
import { Leafr } from "./leaf.js";
export class Renn {
    orders = [];
    constructor(items) {
        if (items)
            this.insert(items);
    }
    insert(srcs, start) {
        start = pos_trim(start, this.orders);
        this.orders.splice(start, 0, ...srcs.map(src => new Order(src)));
        this.update_orders(start, this.orders.length);
    }
    update_orders(start, next) {
        for (let pos = start; pos < next; pos++) {
            this.orders[pos][_set_value_](pos);
        }
    }
}
const pos_trim = (pos, ar) => {
    if (pos === undefined || pos >= ar.length)
        return ar.length;
    if (pos < 0)
        return 0;
    return pos;
};
export class Order extends Leafr {
    src;
    constructor(src, order = undefined) {
        super(order);
        this.src = src;
    }
    _count_;
    get count() {
        return this._count_ ??= new Leafr.Conv(this, v => typeof v == "number" ? v + 1 : v);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVubi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3RzLXNyYy9tZWgvbW9kZWwvcmVubi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsV0FBVyxFQUFPLE1BQU0sY0FBYyxDQUFDO0FBQ2hELE9BQU8sRUFBRSxLQUFLLEVBQVEsTUFBTSxXQUFXLENBQUM7QUFFeEMsTUFBTSxPQUFPLElBQUk7SUFFQSxNQUFNLEdBQW9CLEVBQUUsQ0FBRTtJQUU5QyxZQUFhLEtBQWM7UUFFMUIsSUFBSSxLQUFLO1lBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBRSxLQUFLLENBQUUsQ0FBQztJQUNsQyxDQUFDO0lBR00sTUFBTSxDQUVaLElBQVcsRUFDWCxLQUFtQjtRQUluQixLQUFLLEdBQUcsUUFBUSxDQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFFLENBQUU7UUFFeEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBRWpCLEtBQUssRUFBRSxDQUFDLEVBQ1IsR0FBSSxJQUFJLENBQUMsR0FBRyxDQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxLQUFLLENBQUUsR0FBRyxDQUFFLENBQUUsQ0FDdkMsQ0FBQztRQUVGLElBQUksQ0FBQyxhQUFhLENBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFFLENBQUM7SUFDakQsQ0FBQztJQUVTLGFBQWEsQ0FFdEIsS0FBYyxFQUNkLElBQWE7UUFHYixLQUVDLElBQUksR0FBRyxHQUFHLEtBQUssRUFDZixHQUFHLEdBQUcsSUFBSSxFQUNWLEdBQUcsRUFBRyxFQUVQO1lBQ0MsSUFBSSxDQUFDLE1BQU0sQ0FBRyxHQUFHLENBQUUsQ0FBRyxXQUFXLENBQUUsQ0FBRyxHQUFHLENBQUUsQ0FBQztTQUM1QztJQUNGLENBQUM7Q0FDRDtBQUVELE1BQU0sUUFBUSxHQUFHLENBQUUsR0FBZSxFQUFFLEVBQWtCLEVBQUcsRUFBRTtJQUUxRCxJQUFJLEdBQUcsS0FBSyxTQUFTLElBQUksR0FBRyxJQUFJLEVBQUUsQ0FBQyxNQUFNO1FBQUksT0FBTyxFQUFFLENBQUMsTUFBTSxDQUFFO0lBQy9ELElBQUksR0FBRyxHQUFHLENBQUM7UUFBSSxPQUFPLENBQUMsQ0FBRTtJQUN6QixPQUFPLEdBQUcsQ0FBRTtBQUNiLENBQUMsQ0FBQTtBQUVELE1BQU0sT0FBTyxLQUFZLFNBQVEsS0FBbUI7SUFJbEM7SUFGakIsWUFFaUIsR0FBTyxFQUN2QixRQUFvQixTQUFTO1FBRzdCLEtBQUssQ0FBRSxLQUFLLENBQUUsQ0FBQztRQUpDLFFBQUcsR0FBSCxHQUFHLENBQUk7SUFLeEIsQ0FBQztJQUVTLE9BQU8sQ0FBK0I7SUFFaEQsSUFBVyxLQUFLO1FBRWYsT0FBTyxJQUFJLENBQUMsT0FBTyxLQUFLLElBQUksS0FBSyxDQUFDLElBQUksQ0FFckMsSUFBSSxFQUNKLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3JDLENBQUE7SUFDRixDQUFDO0NBQ0QifQ==