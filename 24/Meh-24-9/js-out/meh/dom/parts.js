import { log } from "../common.js";
import { defs } from "./defs.js";
import * as nodet from "./nodet.js";
export const create_place = (ce, df, def) => (next_place(ce, df, def.flat(20), 0));
const next_place = (ce, df, def, pos) => {
    const cur = def[pos];
    if (cur instanceof defs.Place) {
        pos++;
        if (cur instanceof defs.Each) {
            return new EachPlace(ce, df, cur, def, pos);
        }
    }
    if (cur !== undefined) {
        return new StaticPlace(ce, df, def, pos);
    }
};
/* */
export class Place {
    next;
    make_part(df, pdef) {
        let is_period = false;
        if (pdef instanceof nodet.Nodet) {
            pdef.node && df.appendChild(pdef.node);
        }
        else if (pdef instanceof Node) {
            df.appendChild(pdef);
        }
        else if (!(pdef instanceof defs.Place)) {
            const n = new nodet.Text(pdef);
            n.node && df.appendChild(n.node);
        }
        else
            is_period = true;
        return is_period;
    }
    destruct() { }
}
class StaticPlace extends Place {
    constructor(ce, df, def, pos) {
        super();
        while (pos < def.length) {
            const pdef = def[pos];
            if (this.make_part(df, pdef)) {
                break;
            }
            pos++;
        }
        this.next = next_place(ce, df, def, pos);
    }
}
class EachPlace extends Place {
    constructor(ce, df, edef, def, pos) {
        super();
        log("EachPlace", edef.source.items);
        edef.source.items.forEach(value => this.make_part(df, edef.create_node(value)));
        this.next = next_place(ce, df, def, pos);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFydHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi90cy1zcmMvbWVoL2RvbS9wYXJ0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRW5DLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDakMsT0FBTyxLQUFLLEtBQUssTUFBTSxZQUFZLENBQUM7QUFFcEMsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUN6QixDQUNDLEVBQVksRUFDWixFQUFxQixFQUNyQixHQUFnQixFQUNLLEVBQUUsQ0FDeEIsQ0FDQyxVQUFVLENBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFFLEVBQUUsQ0FBcUIsRUFBRSxDQUFDLENBQUUsQ0FDMUQsQ0FBQztBQUVGLE1BQU0sVUFBVSxHQUNoQixDQUNDLEVBQVksRUFDWixFQUFxQixFQUNyQixHQUFxQixFQUNyQixHQUFZLEVBRU8sRUFBRTtJQUVyQixNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUUsR0FBRyxDQUFFLENBQUM7SUFFdkIsSUFBSSxHQUFHLFlBQVksSUFBSSxDQUFDLEtBQUssRUFDN0I7UUFDQyxHQUFHLEVBQUcsQ0FBRTtRQUVSLElBQUksR0FBRyxZQUFZLElBQUksQ0FBQyxJQUFJLEVBQzVCO1lBQ0MsT0FBTyxJQUFJLFNBQVMsQ0FBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFFLENBQUM7U0FDOUM7S0FDRDtJQUVELElBQUksR0FBRyxLQUFLLFNBQVMsRUFDckI7UUFDQyxPQUFPLElBQUksV0FBVyxDQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBRSxDQUFDO0tBQzNDO0FBQ0YsQ0FBQyxDQUFDO0FBRUYsS0FBSztBQUdMLE1BQU0sT0FBTyxLQUFLO0lBRVAsSUFBSSxDQUFZO0lBRWhCLFNBQVMsQ0FFbEIsRUFBcUIsRUFDckIsSUFBcUI7UUFJckIsSUFBSSxTQUFTLEdBQUcsS0FBSyxDQUFBO1FBRXJCLElBQUksSUFBSSxZQUFZLEtBQUssQ0FBQyxLQUFLLEVBQy9CO1lBQ0MsSUFBSSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxDQUFFLElBQUksQ0FBQyxJQUFJLENBQUUsQ0FBQztTQUN6QzthQUVJLElBQUksSUFBSSxZQUFZLElBQUksRUFDN0I7WUFDQyxFQUFFLENBQUMsV0FBVyxDQUFFLElBQUksQ0FBRSxDQUFDO1NBQ3ZCO2FBRUksSUFBSSxDQUFFLENBQUUsSUFBSSxZQUFZLElBQUksQ0FBQyxLQUFLLENBQUUsRUFDekM7WUFDQyxNQUFNLENBQUMsR0FBRyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUUsSUFBSSxDQUFFLENBQUU7WUFDbEMsQ0FBQyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxDQUFFLENBQUMsQ0FBQyxJQUFJLENBQUUsQ0FBRTtTQUNwQzs7WUFFSSxTQUFTLEdBQUcsSUFBSSxDQUFFO1FBRXZCLE9BQU8sU0FBUyxDQUFFO0lBQ25CLENBQUM7SUFFTSxRQUFRLEtBQ2QsQ0FBQztDQUNGO0FBSUQsTUFBTSxXQUFZLFNBQVEsS0FBSztJQUU5QixZQUVDLEVBQVksRUFDWixFQUFxQixFQUNyQixHQUFxQixFQUNyQixHQUFZO1FBSVosS0FBSyxFQUFFLENBQUM7UUFFUixPQUFPLEdBQUcsR0FBRyxHQUFHLENBQUMsTUFBTSxFQUN2QjtZQUNDLE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBRSxHQUFHLENBQUUsQ0FBRTtZQUV6QixJQUFJLElBQUksQ0FBQyxTQUFTLENBQUUsRUFBRSxFQUFFLElBQUksQ0FBRSxFQUM5QjtnQkFDQyxNQUFPO2FBQ1A7WUFFRCxHQUFHLEVBQUcsQ0FBRTtTQUNSO1FBRUQsSUFBSSxDQUFDLElBQUksR0FBRyxVQUFVLENBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFFLENBQUM7SUFDNUMsQ0FBQztDQUNEO0FBRUQsTUFBTSxTQUFVLFNBQVEsS0FBSztJQUU1QixZQUVDLEVBQVksRUFDWixFQUFxQixFQUNyQixJQUFnQixFQUNoQixHQUFxQixFQUNyQixHQUFZO1FBR1osS0FBSyxFQUFFLENBQUM7UUFFUixHQUFHLENBQUUsV0FBVyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFFLENBQUE7UUFFckMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUV4QixLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBRXRCLEVBQUUsRUFDRixJQUFJLENBQUMsV0FBVyxDQUFFLEtBQUssQ0FBRSxDQUN6QixDQUNELENBQUM7UUFFRixJQUFJLENBQUMsSUFBSSxHQUFHLFVBQVUsQ0FBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUUsQ0FBQztJQUM1QyxDQUFDO0NBQ0QifQ==