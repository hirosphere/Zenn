import { leaf, Renn, ef, each, dom, log } from "../meh/index.js";
export var vm;
(function (vm) {
    class App {
        title;
        items;
        editor;
        constructor(v) {
            this.title = leaf.str(v.title);
            this.items = new Items(v.items);
            this.editor = new Editor(this.items);
            this.items.rand_check();
            document.title = v.title;
        }
    }
    vm.App = App;
    class Editor {
        items;
        text = leaf.str("なにする？");
        constructor(items) {
            this.items = items;
        }
        post() {
            const item = new Item({ text: this.text.value });
            this.items.new([item], 0);
            this.text.value = "";
        }
    }
    vm.Editor = Editor;
    class Items extends Renn {
        constructor(v) {
            super();
            this.value = v;
        }
        set value(v) {
            this.clear();
            const s = v.map(v => new Item(v));
            this.new(s);
        }
        clear_completed() {
            const list = this.orders.filter(o => o.src.completed.value);
            list.forEach(o => o.remove());
        }
        rand_check() {
            this.orders.forEach(o => o.src.completed.value = bool_rand(0.25));
        }
    }
    vm.Items = Items;
    class Item {
        text;
        completed;
        constructor(v) {
            this.text = leaf(v.text);
            this.completed = leaf(false);
            log(v.text);
        }
    }
    vm.Item = Item;
    const bool_rand = (r = 0.5) => Math.random() < r;
})(vm || (vm = {}));
export var vc;
(function (vc) {
    vc.App = (m) => {
        return ef.article({ class: "fc" }, ef.h1(m.title), Post(m.editor), ef.section({ class: "bar" }, command("Random", () => m.items.rand_check()), command("削除", () => m.items.clear_completed())), ef.ul({ class: "todo-list" }, each(m.items, o => Item(o))));
    };
    const Post = (m) => {
        return ef.form({
            class: "post",
            acts: {
                submit(ev) {
                    ev.preventDefault();
                    m.post();
                    log("post", m.text.value);
                }
            }
        }, ef.input({
            class: "text",
            props: {
                value: m.text
            },
            acts: {
                input(ev) {
                    if (!(ev.target instanceof HTMLInputElement))
                        return;
                    m.text.value = ev.target.value;
                }
            }
        }), ef.input({
            class: "submit",
            props: { type: "submit", value: "作成" }
        }));
    };
    const Item = (o) => {
        const m = o.src;
        return ef.li({ class: ["todo-item", { completed: m.completed }] }, ef.span(o.count), ef.span(m.text), checkbox(m.completed));
    };
    const command = (label, act) => {
        return ef.button({ acts: { click: act } }, label);
    };
    const checkbox = (state) => {
        return ef.input({
            attrs: { type: "checkbox" },
            props: { checked: state },
            acts: {
                change(ev) {
                    if (ev.target instanceof HTMLInputElement) {
                        state.value = ev.target.checked;
                    }
                }
            }
        });
    };
})(vc || (vc = {}));
const main = () => {
    const v = {
        title: "ToDo 日本史",
        items: [
            { text: "矢じりを作る" },
            { text: "稲作を教える" },
            { text: "製鉄を教える" },
            { text: "民族を移動する" },
            { text: "都を作る" },
            { text: "都を移す" },
            { text: "半島を統一する" },
            { text: "アヘンを売る" },
            { text: "ロシアに勝つ" },
            { text: "阪急電鉄を興す" },
            { text: "箱根土地を始める" },
            { text: "英米を倒す" },
            { text: "ハイチュウを買う" },
            { text: "たけのこの里を分譲" },
        ]
    };
    dom.add(vc.App(new vm.App(v)), "body");
};
main();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicS10b2RvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdHMtc3JjL3ExL3EtdG9kby50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQVMsTUFBTSxpQkFBaUIsQ0FBRTtBQWlCekUsTUFBTSxLQUFXLEVBQUUsQ0FrRmxCO0FBbEZELFdBQWlCLEVBQUU7SUFFbEIsTUFBYSxHQUFHO1FBRUMsS0FBSyxDQUFrQjtRQUN2QixLQUFLLENBQUU7UUFDUCxNQUFNLENBQUU7UUFFeEIsWUFBYSxDQUFVO1lBRXRCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBRyxDQUFDLENBQUMsS0FBSyxDQUFFLENBQUM7WUFFbEMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBRyxDQUFDLENBQUMsS0FBSyxDQUFFLENBQUU7WUFDcEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBRSxJQUFJLENBQUMsS0FBSyxDQUFFLENBQUU7WUFFeEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUN4QixRQUFRLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUU7UUFDM0IsQ0FBQztLQUNEO0lBaEJZLE1BQUcsTUFnQmYsQ0FBQTtJQUVELE1BQWEsTUFBTTtRQUlLO1FBRlAsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUcsT0FBTyxDQUFFLENBQUU7UUFFN0MsWUFBdUIsS0FBYTtZQUFiLFVBQUssR0FBTCxLQUFLLENBQVE7UUFFcEMsQ0FBQztRQUVNLElBQUk7WUFFVixNQUFNLElBQUksR0FBRyxJQUFJLElBQUksQ0FBRSxFQUFFLElBQUksRUFBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFFLENBQUU7WUFDckQsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUcsQ0FBRSxJQUFJLENBQUUsRUFBRyxDQUFDLENBQUUsQ0FBQTtZQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDdEIsQ0FBQztLQUNEO0lBZFksU0FBTSxTQWNsQixDQUFBO0lBRUQsTUFBYSxLQUFNLFNBQVEsSUFBYTtRQUV2QyxZQUFhLENBQWM7WUFFMUIsS0FBSyxFQUFHLENBQUU7WUFDVixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBRTtRQUNqQixDQUFDO1FBRUQsSUFBVyxLQUFLLENBQUcsQ0FBYztZQUVoQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUU7WUFDZCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxJQUFJLENBQUcsQ0FBQyxDQUFFLENBQUUsQ0FBQTtZQUN0QyxJQUFJLENBQUMsR0FBRyxDQUFHLENBQUMsQ0FBRSxDQUFFO1FBQ2pCLENBQUM7UUFFTSxlQUFlO1lBRXJCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFFLENBQUM7WUFFOUQsSUFBSSxDQUFDLE9BQU8sQ0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUcsQ0FBRSxDQUFFO1FBQ3BDLENBQUM7UUFFTSxVQUFVO1lBRWhCLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUVsQixDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUUsSUFBSSxDQUFFLENBQzlDLENBQUM7UUFDSCxDQUFDO0tBQ0Q7SUE3QlksUUFBSyxRQTZCakIsQ0FBQTtJQUVELE1BQWEsSUFBSTtRQUVBLElBQUksQ0FBRTtRQUNOLFNBQVMsQ0FBRTtRQUUzQixZQUFhLENBQVc7WUFFdkIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUUsQ0FBQyxDQUFDLElBQUksQ0FBRSxDQUFFO1lBQzVCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFFLEtBQUssQ0FBRSxDQUFFO1lBRWhDLEdBQUcsQ0FBRSxDQUFDLENBQUMsSUFBSSxDQUFFLENBQUM7UUFDZixDQUFDO0tBQ0Q7SUFaWSxPQUFJLE9BWWhCLENBQUE7SUFFRCxNQUFNLFNBQVMsR0FBRyxDQUFFLENBQUMsR0FBRyxHQUFHLEVBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUU7QUFDckQsQ0FBQyxFQWxGZ0IsRUFBRSxLQUFGLEVBQUUsUUFrRmxCO0FBRUQsTUFBTSxLQUFXLEVBQUUsQ0EySGxCO0FBM0hELFdBQWlCLEVBQUU7SUFFTCxNQUFHLEdBQUcsQ0FBRSxDQUFVLEVBQW1CLEVBQUU7UUFFbkQsT0FBTyxFQUFFLENBQUMsT0FBTyxDQUVoQixFQUFFLEtBQUssRUFBRyxJQUFJLEVBQUUsRUFFaEIsRUFBRSxDQUFDLEVBQUUsQ0FBRSxDQUFDLENBQUMsS0FBSyxDQUFFLEVBRWhCLElBQUksQ0FBRSxDQUFDLENBQUMsTUFBTSxDQUFFLEVBRWhCLEVBQUUsQ0FBQyxPQUFPLENBQ1QsRUFBRSxLQUFLLEVBQUcsS0FBSyxFQUFFLEVBQ2pCLE9BQU8sQ0FFTixRQUFRLEVBQ1IsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FDMUIsRUFDRCxPQUFPLENBRU4sSUFBSSxFQUNKLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsZUFBZSxFQUFHLENBQ2hDLENBQ0QsRUFFRCxFQUFFLENBQUMsRUFBRSxDQUNKLEVBQUUsS0FBSyxFQUFHLFdBQVcsRUFBRSxFQUN2QixJQUFJLENBQ0gsQ0FBQyxDQUFDLEtBQUssRUFDUCxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBRSxDQUFDLENBQUUsQ0FDZCxDQUNELENBQ0QsQ0FBQztJQUNILENBQUMsQ0FBQTtJQUVELE1BQU0sSUFBSSxHQUFHLENBQUUsQ0FBYSxFQUFHLEVBQUU7UUFFaEMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUViO1lBQ0MsS0FBSyxFQUFHLE1BQU07WUFDZCxJQUFJLEVBQ0o7Z0JBQ0MsTUFBTSxDQUFFLEVBQUU7b0JBRVQsRUFBRSxDQUFDLGNBQWMsRUFBRSxDQUFFO29CQUNyQixDQUFDLENBQUMsSUFBSSxFQUFFLENBQUU7b0JBQ1YsR0FBRyxDQUFFLE1BQU0sRUFBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBRSxDQUFDO2dCQUM5QixDQUFDO2FBQ0Q7U0FDRCxFQUNELEVBQUUsQ0FBQyxLQUFLLENBRVA7WUFDQyxLQUFLLEVBQUcsTUFBTTtZQUNkLEtBQUssRUFDTDtnQkFDQyxLQUFLLEVBQUcsQ0FBQyxDQUFDLElBQUk7YUFDZDtZQUNELElBQUksRUFDSjtnQkFDQyxLQUFLLENBQUUsRUFBRTtvQkFFUixJQUFJLENBQUUsQ0FBRSxFQUFFLENBQUMsTUFBTSxZQUFZLGdCQUFnQixDQUFFO3dCQUFJLE9BQVE7b0JBRTNELENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO2dCQUNoQyxDQUFDO2FBQ0Q7U0FDRCxDQUNELEVBQ0QsRUFBRSxDQUFDLEtBQUssQ0FFUDtZQUNDLEtBQUssRUFBRyxRQUFRO1lBQ2hCLEtBQUssRUFBRyxFQUFFLElBQUksRUFBRyxRQUFRLEVBQUcsS0FBSyxFQUFHLElBQUksRUFBRTtTQUMxQyxDQUNELENBQ0QsQ0FBQztJQUNILENBQUMsQ0FBQTtJQUVELE1BQU0sSUFBSSxHQUFHLENBQUUsQ0FBcUIsRUFBRyxFQUFFO1FBRXhDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUU7UUFDakIsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUVYLEVBQUUsS0FBSyxFQUFHLENBQUUsV0FBVyxFQUFHLEVBQUUsU0FBUyxFQUFHLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBRSxFQUFFLEVBQ3pELEVBQUUsQ0FBQyxJQUFJLENBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBRSxFQUNsQixFQUFFLENBQUMsSUFBSSxDQUFFLENBQUMsQ0FBQyxJQUFJLENBQUUsRUFDakIsUUFBUSxDQUFFLENBQUMsQ0FBQyxTQUFTLENBQUUsQ0FDdkIsQ0FBQTtJQUNGLENBQUMsQ0FBQztJQUVGLE1BQU0sT0FBTyxHQUFHLENBQUUsS0FBYyxFQUFHLEdBQWdCLEVBQUcsRUFBRTtRQUV2RCxPQUFPLEVBQUUsQ0FBQyxNQUFNLENBRWYsRUFBRSxJQUFJLEVBQUcsRUFBRSxLQUFLLEVBQUcsR0FBRyxFQUFFLEVBQUUsRUFDMUIsS0FBSyxDQUNMLENBQUM7SUFDSCxDQUFDLENBQUE7SUFHRCxNQUFNLFFBQVEsR0FBRyxDQUFFLEtBQXNCLEVBQUcsRUFBRTtRQUU3QyxPQUFPLEVBQUUsQ0FBQyxLQUFLLENBRWQ7WUFDQyxLQUFLLEVBQUcsRUFBRSxJQUFJLEVBQUcsVUFBVSxFQUFFO1lBQzdCLEtBQUssRUFBRyxFQUFFLE9BQU8sRUFBRyxLQUFLLEVBQUU7WUFDM0IsSUFBSSxFQUNKO2dCQUNDLE1BQU0sQ0FBRyxFQUFFO29CQUVWLElBQUksRUFBRSxDQUFDLE1BQU0sWUFBWSxnQkFBZ0IsRUFDekM7d0JBQ0MsS0FBSyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBRTtxQkFDakM7Z0JBQ0YsQ0FBQzthQUNEO1NBQ0QsQ0FDRCxDQUFDO0lBQ0gsQ0FBQyxDQUFDO0FBQ0gsQ0FBQyxFQTNIZ0IsRUFBRSxLQUFGLEVBQUUsUUEySGxCO0FBR0QsTUFBTSxJQUFJLEdBQUcsR0FBRyxFQUFFO0lBRWpCLE1BQU0sQ0FBQyxHQUNQO1FBQ0MsS0FBSyxFQUFHLFVBQVU7UUFDbEIsS0FBSyxFQUNMO1lBQ0MsRUFBRSxJQUFJLEVBQUcsUUFBUSxFQUFFO1lBQ25CLEVBQUUsSUFBSSxFQUFHLFFBQVEsRUFBRTtZQUNuQixFQUFFLElBQUksRUFBRyxRQUFRLEVBQUU7WUFDbkIsRUFBRSxJQUFJLEVBQUcsU0FBUyxFQUFFO1lBQ3BCLEVBQUUsSUFBSSxFQUFHLE1BQU0sRUFBRTtZQUNqQixFQUFFLElBQUksRUFBRyxNQUFNLEVBQUU7WUFDakIsRUFBRSxJQUFJLEVBQUcsU0FBUyxFQUFFO1lBQ3BCLEVBQUUsSUFBSSxFQUFHLFFBQVEsRUFBRTtZQUNuQixFQUFFLElBQUksRUFBRyxRQUFRLEVBQUU7WUFDbkIsRUFBRSxJQUFJLEVBQUcsU0FBUyxFQUFFO1lBQ3BCLEVBQUUsSUFBSSxFQUFHLFVBQVUsRUFBRTtZQUNyQixFQUFFLElBQUksRUFBRyxPQUFPLEVBQUU7WUFDbEIsRUFBRSxJQUFJLEVBQUcsVUFBVSxFQUFFO1lBQ3JCLEVBQUUsSUFBSSxFQUFHLFdBQVcsRUFBRTtTQUN0QjtLQUNELENBQUM7SUFFRixHQUFHLENBQUMsR0FBRyxDQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUUsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFHLENBQUMsQ0FBRSxDQUFFLEVBQUcsTUFBTSxDQUFFLENBQUM7QUFDaEQsQ0FBQyxDQUFDO0FBRUYsSUFBSSxFQUFFLENBQUUifQ==