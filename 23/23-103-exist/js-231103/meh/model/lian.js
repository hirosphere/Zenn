// class Lian ( 連：リエン・れん ) Arrayをリアクティブにするクラス //
import { Leaf } from "./leaf.js";
const log = console.log;
export class Lian extends Array {
    static create(srcvalue = []) {
        const rt = new Lian();
        rt.set(srcvalue);
        return rt;
    }
    //  //
    set(array) {
        this.clear();
        array.forEach((value, order) => this[order] = new Item(this, order, value));
    }
    refs = new Set();
    ref(ref) {
        log("Lian ref", ref);
        this.refs.add(ref);
    }
    // order operations //
    swap(orderA, orderB) {
        ;
    }
    add(itemValue, order) {
        const ord = regnext(this, order);
        this.splice(ord, 0, new Item(this, ord, itemValue));
        this.reorder(ord, this.length);
        this.refs.forEach(ref => ref.add?.(ord, 1));
    }
    remove(item) {
        const order = item.order.value;
        if (order < 0 || this.length <= order)
            return;
        this.splice(order, 1);
        this.reorder(order, this.length);
        this.refs.forEach(ref => ref.remove?.(order, 1));
    }
    clear() {
        const len = this.length;
        this.refs.forEach((ref) => ref.remove?.(0, len));
        this.length = 0;
    }
    //  //
    reorder(start, next) {
        for (let ord = start; ord < next; ord++) {
            this[ord].order.value = ord;
        }
    }
}
const regnext = (ar, order) => {
    if (order == undefined || order > ar.length || order < 0)
        return ar.length;
    return order;
};
class Item extends Leaf {
    order;
    isLast = new Leaf.Boolean(false);
    lian;
    constructor(lian, order, value) {
        super(value);
        this.order = new Leaf.Number(order);
        this.lian = lian;
    }
    remove() {
        this.lian?.remove(this);
        this.lian = null;
    }
}
export const LianItem = Item;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlhbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3RzLXNyYy9tZWgvbW9kZWwvbGlhbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnREFBZ0Q7QUFFaEQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVqQyxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO0FBRXhCLE1BQU0sT0FBTyxJQUFpQixTQUFRLEtBQW9CO0lBRXpELE1BQU0sQ0FBQyxNQUFNLENBQVMsV0FBeUIsRUFBRTtRQUVoRCxNQUFNLEVBQUUsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3RCLEVBQUUsQ0FBQyxHQUFHLENBQUUsUUFBUSxDQUFFLENBQUM7UUFDbkIsT0FBTyxFQUFFLENBQUM7SUFDWCxDQUFDO0lBRUQsTUFBTTtJQUVDLEdBQUcsQ0FBRSxLQUFtQjtRQUU5QixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDYixLQUFLLENBQUMsT0FBTyxDQUFFLENBQUUsS0FBSyxFQUFFLEtBQUssRUFBRyxFQUFFLENBQUMsSUFBSSxDQUFFLEtBQUssQ0FBRSxHQUFHLElBQUksSUFBSSxDQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFFLENBQUUsQ0FBQztJQUNyRixDQUFDO0lBRVMsSUFBSSxHQUFHLElBQUksR0FBRyxFQUFnQixDQUFDO0lBRWxDLEdBQUcsQ0FBRSxHQUFjO1FBRXpCLEdBQUcsQ0FBRSxVQUFVLEVBQUUsR0FBRyxDQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUUsR0FBRyxDQUFFLENBQUM7SUFDdEIsQ0FBQztJQUVELHNCQUFzQjtJQUVmLElBQUksQ0FBRSxNQUFlLEVBQUUsTUFBZTtRQUU1QyxDQUFDO0lBQ0YsQ0FBQztJQUVNLEdBQUcsQ0FBRSxTQUFhLEVBQUUsS0FBZ0I7UUFFMUMsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFFLElBQUksRUFBRSxLQUFLLENBQUUsQ0FBQztRQUNuQyxJQUFJLENBQUMsTUFBTSxDQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxTQUFTLENBQUUsQ0FBRSxDQUFDO1FBRXhELElBQUksQ0FBQyxPQUFPLENBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUUsQ0FBQztRQUNqQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBRyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBRSxHQUFHLEVBQUUsQ0FBQyxDQUFFLENBQUcsQ0FBQztJQUNuRCxDQUFDO0lBRU0sTUFBTSxDQUFFLElBQWlCO1FBRS9CLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQy9CLElBQUksS0FBSyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLEtBQUs7WUFBRyxPQUFPO1FBQy9DLElBQUksQ0FBQyxNQUFNLENBQUUsS0FBSyxFQUFFLENBQUMsQ0FBRSxDQUFDO1FBRXhCLElBQUksQ0FBQyxPQUFPLENBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUUsQ0FBQztRQUNuQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBRyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBRSxLQUFLLEVBQUUsQ0FBQyxDQUFFLENBQUcsQ0FBQztJQUN4RCxDQUFDO0lBRU0sS0FBSztRQUVYLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUcsQ0FBRSxHQUFHLEVBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBRSxDQUFDLEVBQUUsR0FBRyxDQUFFLENBQUcsQ0FBQztRQUN6RCxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNqQixDQUFDO0lBRUQsTUFBTTtJQUVJLE9BQU8sQ0FBRSxLQUFjLEVBQUUsSUFBYTtRQUUvQyxLQUFLLElBQUksR0FBRyxHQUFHLEtBQUssRUFBRSxHQUFHLEdBQUcsSUFBSSxFQUFFLEdBQUcsRUFBRyxFQUN4QztZQUNDLElBQUksQ0FBRSxHQUFHLENBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztTQUM5QjtJQUNGLENBQUM7Q0FDRDtBQUVELE1BQU0sT0FBTyxHQUFHLENBQUUsRUFBa0IsRUFBRSxLQUFnQixFQUFZLEVBQUU7SUFFbkUsSUFBSSxLQUFLLElBQUksU0FBUyxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUMsTUFBTSxJQUFJLEtBQUssR0FBRyxDQUFDO1FBQUcsT0FBTyxFQUFFLENBQUMsTUFBTSxDQUFDO0lBQzVFLE9BQU8sS0FBSyxDQUFDO0FBQ2QsQ0FBQyxDQUFBO0FBRUQsTUFBTSxJQUFXLFNBQVEsSUFBVTtJQUVsQixLQUFLLENBQUM7SUFDTixNQUFNLEdBQUcsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFFLEtBQUssQ0FBRSxDQUFDO0lBQ3pDLElBQUksQ0FBcUI7SUFFbkMsWUFBYSxJQUFpQixFQUFFLEtBQWMsRUFBRSxLQUFTO1FBRXhELEtBQUssQ0FBRSxLQUFLLENBQUUsQ0FBQztRQUNmLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFFLEtBQUssQ0FBRSxDQUFDO1FBQ3RDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ2xCLENBQUM7SUFFRCxNQUFNO1FBRUwsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUUsSUFBSSxDQUFFLENBQUM7UUFDMUIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDbEIsQ0FBQztDQUNEO0FBRUQsTUFBTSxDQUFDLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyJ9