import { Exist } from "../model/index.js";
import { defs } from "./defs.js";
import { Nodet } from "./nodet.js";
const log = console.log;
export const createParts = (owner, def, ce) => {
    return new DefReader(owner, def, ce).next;
};
class DefReader {
    owner;
    def;
    ce;
    constructor(owner, def, ce) {
        this.owner = owner;
        this.def = def;
        this.ce = ce;
    }
    pos = 0;
    get next() {
        if (this.pos >= this.def.length)
            return;
        const pdef = this.def[this.pos];
        if (pdef instanceof defs.Each) {
            this.pos++;
            return new EachPF(pdef, this);
        }
        return new LiteralPF(this);
    }
    literal(fn) {
        while (this.pos < this.def.length) {
            const pdef = this.def[this.pos];
            if (pdef instanceof defs.Each)
                break;
            this.pos++;
            fn(pdef);
        }
    }
}
/** class PartsFragment */
export class PartsFragment extends Exist {
    next;
    items = new Array;
    createItem(def, ce) {
        log(def);
        return new Nodet(this, def, ce);
    }
}
/** Literal Parts Fragment  */
class LiteralPF extends PartsFragment {
    constructor(rd) {
        super(rd.owner);
        rd.literal(def => this.createItem(def, rd.ce));
        this.next = rd.next;
    }
}
/** Each Parts Fragment */
class EachPF extends PartsFragment {
    constructor(def, rd) {
        super(rd.owner);
        if (def.source instanceof Array) {
            def.source.forEach(value => this.createItem(def.create(value), rd.ce));
        }
        this.next = rd.next;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFydHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi90cy1zcmMvbWVoL2RvbS9wYXJ0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFTLE1BQU0sbUJBQW1CLENBQUM7QUFDakQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNqQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBRW5DLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7QUFFeEIsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLENBQUUsS0FBYSxFQUFFLEdBQWtCLEVBQUUsRUFBWSxFQUErQixFQUFFO0lBRTVHLE9BQU8sSUFBSSxTQUFTLENBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUUsQ0FBQyxJQUFJLENBQUM7QUFDN0MsQ0FBQyxDQUFDO0FBRUYsTUFBTSxTQUFTO0lBSU47SUFDQTtJQUNBO0lBSlIsWUFFUSxLQUFhLEVBQ2IsR0FBa0IsRUFDbEIsRUFBWTtRQUZaLFVBQUssR0FBTCxLQUFLLENBQVE7UUFDYixRQUFHLEdBQUgsR0FBRyxDQUFlO1FBQ2xCLE9BQUUsR0FBRixFQUFFLENBQVU7SUFFbkIsQ0FBQztJQUVGLEdBQUcsR0FBWSxDQUFDLENBQUM7SUFFakIsSUFBSSxJQUFJO1FBRVAsSUFBSSxJQUFJLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTTtZQUFJLE9BQU87UUFFMUMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBRSxJQUFJLENBQUMsR0FBRyxDQUFFLENBQUM7UUFDbEMsSUFBSSxJQUFJLFlBQVksSUFBSSxDQUFDLElBQUksRUFDN0I7WUFDQyxJQUFJLENBQUMsR0FBRyxFQUFHLENBQUM7WUFDWixPQUFPLElBQUksTUFBTSxDQUFFLElBQUksRUFBRSxJQUFJLENBQUUsQ0FBQztTQUNoQztRQUNELE9BQU8sSUFBSSxTQUFTLENBQUUsSUFBSSxDQUFFLENBQUM7SUFDOUIsQ0FBQztJQUVELE9BQU8sQ0FBRSxFQUErQjtRQUV2QyxPQUFPLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQ2pDO1lBQ0MsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBRSxJQUFJLENBQUMsR0FBRyxDQUFFLENBQUM7WUFDbEMsSUFBSSxJQUFJLFlBQVksSUFBSSxDQUFDLElBQUk7Z0JBQUcsTUFBTTtZQUV0QyxJQUFJLENBQUMsR0FBRyxFQUFHLENBQUM7WUFDWixFQUFFLENBQUUsSUFBSSxDQUFFLENBQUM7U0FDWDtJQUNGLENBQUM7Q0FDRDtBQUdELDBCQUEwQjtBQUUxQixNQUFNLE9BQU8sYUFBYyxTQUFRLEtBQUs7SUFFaEMsSUFBSSxDQUFtQjtJQUNwQixLQUFLLEdBQUcsSUFBSSxLQUFlLENBQUU7SUFFN0IsVUFBVSxDQUFFLEdBQWUsRUFBRSxFQUFZO1FBRWxELEdBQUcsQ0FBRSxHQUFHLENBQUUsQ0FBQztRQUNYLE9BQU8sSUFBSSxLQUFLLENBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUUsQ0FBQztJQUNuQyxDQUFDO0NBQ0Q7QUFHRCw4QkFBOEI7QUFFOUIsTUFBTSxTQUFVLFNBQVEsYUFBYTtJQUVwQyxZQUFhLEVBQWM7UUFFMUIsS0FBSyxDQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUUsQ0FBQztRQUNsQixFQUFFLENBQUMsT0FBTyxDQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBRSxDQUFFLENBQUM7UUFDbkQsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDO0lBQ3JCLENBQUM7Q0FDRDtBQUVELDBCQUEwQjtBQUUxQixNQUFNLE1BQU8sU0FBUSxhQUFhO0lBRWpDLFlBQWEsR0FBZSxFQUFFLEVBQWM7UUFFM0MsS0FBSyxDQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUUsQ0FBQztRQUVsQixJQUFJLEdBQUcsQ0FBQyxNQUFNLFlBQVksS0FBSyxFQUMvQjtZQUNDLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUNqQixLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQ3ZCLEdBQUcsQ0FBQyxNQUFNLENBQUUsS0FBSyxDQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBRSxDQUM3QixDQUFDO1NBQ0Y7UUFFRCxJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUM7SUFDckIsQ0FBQztDQUNEIn0=