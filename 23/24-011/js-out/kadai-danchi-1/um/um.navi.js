import { navi, log, root } from "../../meh/index.js";
const ents = Object.entries;
const vals = Object.values;
export const browser = new class extends navi.Browser {
    constructor() {
        super(root, {});
    }
    make_link(index) {
        const ps = {
            room: index.path.value,
        };
        return this.root + "?" + new URLSearchParams(ps).toString();
    }
};
export class Index extends navi.Index {
}
const make_path = (index, con) => {
    return (con ? con.path.v + "-" : "") + index;
};
export class Danchi extends Index {
    parts = {};
    constructor(con, src) {
        super(con, browser, {});
        for (const [pindex, psrc] of ents(src.blocks)) {
            this.parts[pindex] = new Block(this, pindex, psrc, this.rooms);
        }
    }
    rooms = {};
}
export class Block extends Index {
    index;
    constructor(con, index, src, rooms) {
        super(con, browser, { path: make_path(index) });
        this.index = index;
        // log( this.path, "街区" );
        for (const [pindex, psrc] of ents(src.buildings)) {
            this.parts[pindex] = new Building(this, pindex, psrc, rooms);
        }
    }
    parts = {};
}
export class Building extends Index {
    index;
    constructor(con, index, src, rooms) {
        super(con, browser, { path: make_path(index, con) });
        this.index = index;
        log(this.path.v);
        for (const [pindex, psrc] of ents(src.rooms)) {
            this.parts[pindex] = new Room(this, pindex, psrc, rooms);
        }
    }
    parts = {};
}
export class Room extends Index {
    index;
    src;
    constructor(con, index, src, rooms) {
        super(con, browser, { title: src.title, path: make_path(index, con) });
        this.index = index;
        this.src = src;
        // log( this.path.v );
        // log( this.link );
        this.mod_path = `./${this.path.v.replace(/-/g, "/")}.js`;
        rooms[this.path.v] = this;
    }
    get available() {
        return this.src.available ?? false;
    }
    mod_path;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW0ubmF2aS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3RzLXNyYy9rYWRhaS1kYW5jaGktMS91bS91bS5uYXZpLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQVEsRUFBb0MsSUFBSSxFQUFXLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUtqRyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO0FBQzVCLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7QUFFM0IsTUFBTSxDQUFDLE1BQU0sT0FBTyxHQUFHLElBQUksS0FBTSxTQUFRLElBQUksQ0FBQyxPQUFPO0lBRXBEO1FBRUMsS0FBSyxDQUFFLElBQUksRUFBRSxFQUFFLENBQUUsQ0FBQztJQUNuQixDQUFDO0lBRWUsU0FBUyxDQUFFLEtBQWtCO1FBRTVDLE1BQU0sRUFBRSxHQUNSO1lBQ0MsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSztTQUN0QixDQUFDO1FBQ0YsT0FBTyxJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxJQUFJLGVBQWUsQ0FBRSxFQUFFLENBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUMvRCxDQUFDO0NBQ0QsQ0FBQztBQUVGLE1BQU0sT0FBTyxLQUFNLFNBQVEsSUFBSSxDQUFDLEtBQUs7Q0FFcEM7QUFFRCxNQUFNLFNBQVMsR0FBRyxDQUFFLEtBQXNCLEVBQUUsR0FBYSxFQUFHLEVBQUU7SUFFN0QsT0FBTyxDQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUUsR0FBRyxLQUFLLENBQUM7QUFDaEQsQ0FBQyxDQUFBO0FBRUQsTUFBTSxPQUFPLE1BQU8sU0FBUSxLQUFLO0lBRWhDLEtBQUssR0FBc0MsRUFBRSxDQUFDO0lBRTlDLFlBQWEsR0FBVSxFQUFFLEdBQXFC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