import { navi, log, root } from "../../meh/index.js";
const ents = Object.entries;
const vals = Object.values;
export const browser = new class extends navi.Browser {
    constructor() {
        super(root, {});
    }
    make_link(index) {
        const ps = {
            room: index.path.value,
        };
        return this.root + "?" + new URLSearchParams(ps).toString();
    }
};
export class Index extends navi.Index {
}
const make_path = (index, con) => {
    return (con ? con.path.v + "-" : "") + index;
};
export class Danchi extends Index {
    parts = {};
    constructor(con, src) {
        super(con, browser);
        for (const [pindex, psrc] of ents(src.blocks)) {
            this.parts[pindex] = new Block(this, pindex, psrc, this.rooms);
        }
    }
    rooms = {};
}
export class Block extends Index {
    index;
    constructor(con, index, src, rooms) {
        super(con, browser, { path: make_path(index) });
        this.index = index;
        // log( this.path, "街区" );
        for (const [pindex, psrc] of ents(src.buildings)) {
            this.parts[pindex] = new Building(this, pindex, psrc, rooms);
        }
    }
    parts = {};
}
export class Building extends Index {
    index;
    constructor(con, index, src, rooms) {
        super(con, browser, { path: make_path(index, con) });
        this.index = index;
        log(this.path.v);
        for (const [pindex, psrc] of ents(src.rooms)) {
            this.parts[pindex] = new Room(this, pindex, psrc, rooms);
        }
    }
    parts = {};
}
export class Room extends Index {
    index;
    src;
    constructor(con, index, src, rooms) {
        super(con, browser, { title: src.title, path: make_path(index, con) });
        this.index = index;
        this.src = src;
        // log( this.path.v );
        // log( this.link );
        this.mod_path = `./${this.path.v.replace(/-/g, "/")}.js`;
        rooms[this.path.v] = this;
    }
    get available() {
        return this.src.available ?? false;
    }
    mod_path;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmF2aS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3RzLXNyYy9rYWRhaS1kYW5jaGktMS91bS9uYXZpLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQVEsRUFBeUMsSUFBSSxFQUFXLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUt0RyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO0FBQzVCLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7QUFFM0IsTUFBTSxDQUFDLE1BQU0sT0FBTyxHQUFHLElBQUksS0FBTSxTQUFRLElBQUksQ0FBQyxPQUFPO0lBRXBEO1FBRUMsS0FBSyxDQUFFLElBQUksRUFBRSxFQUFFLENBQUUsQ0FBQztJQUNuQixDQUFDO0lBRWUsU0FBUyxDQUFFLEtBQWtCO1FBRTVDLE1BQU0sRUFBRSxHQUNSO1lBQ0MsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSztTQUN0QixDQUFDO1FBQ0YsT0FBTyxJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxJQUFJLGVBQWUsQ0FBRSxFQUFFLENBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUMvRCxDQUFDO0NBQ0QsQ0FBQztBQUVGLE1BQU0sT0FBTyxLQUFNLFNBQVEsSUFBSSxDQUFDLEtBQUs7Q0FFcEM7QUFFRCxNQUFNLFNBQVMsR0FBRyxDQUFFLEtBQXNCLEVBQUUsR0FBYSxFQUFHLEVBQUU7SUFFN0QsT0FBTyxDQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUUsR0FBRyxLQUFLLENBQUM7QUFDaEQsQ0FBQyxDQUFBO0FBRUQsTUFBTSxPQUFPLE1BQU8sU0FBUSxLQUFLO0lBRWhDLEtBQUssR0FBc0MsRUFBRSxDQUFDO0lBRTlDLFlBQWEsR0FBUSxFQUFFLEdBQXFCO1FBRTND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