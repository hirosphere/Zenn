import { Exist, _owner, _refs } from "./exist.js";
import { Branch } from "./branch.js";
const log = console.log;
/** Leaf Readonly */
export const _setvalue = Symbol();
export class Leafr extends Exist {
    _value;
    static make(owner, lol) {
        return lol instanceof Leafr ? lol : new Leafr(owner, lol);
    }
    ;
    /**  */
    constructor(container, _value) {
        super(container);
        this._value = _value;
    }
    /** value */
    get v() { return this._value; }
    get val() { return this._value; }
    get value() { return this._value; }
    get() { return this._value; }
    [_setvalue](newv, changer) {
        if (newv === this._value)
            return false;
        const oldv = this._value;
        this._value = newv;
        if (changer != this[_owner] && this[_owner] instanceof Branch) {
            this[_owner].update();
        }
        this[_refs].forEach(ref => {
            (ref instanceof Leafr.Ref)
                && ref._new_value(newv, oldv);
        });
        return true;
    }
}
(function (Leafr) {
    class Ref extends Exist.Ref {
        leafr_acts;
        constructor(refcon, leafr_acts, source) {
            super(refcon, leafr_acts);
            this.leafr_acts = leafr_acts;
            this.source = source;
        }
        _new_source(news, olds) {
            if (news instanceof Leafr)
                this._new_value(news.value);
        }
        _new_value(newv, oldv) {
            this.leafr_acts.new_value?.(newv, oldv);
        }
    }
    Leafr.Ref = Ref;
})(Leafr || (Leafr = {}));
(function (Leafr) {
    /** プリミティブ型シュガー */
    class String extends Leafr {
    }
    Leafr.String = String;
    class Number extends Leafr {
    }
    Leafr.Number = Number;
    class Boolean extends Leafr {
    }
    Leafr.Boolean = Boolean;
    ;
})(Leafr || (Leafr = {}));
/** Leaf RW  */
export class Leaf extends Leafr {
    static make(owner, lol) {
        return lol instanceof Leaf ? lol : new Leaf(owner, lol);
    }
    ;
    /**  */
    set(newv, changer) {
        return this[_setvalue](newv, changer);
    }
    set v(newv) { this[_setvalue](newv); }
    set val(newv) { this[_setvalue](newv); }
    set value(newv) { this[_setvalue](newv); }
    get v() { return this._value; }
    get val() { return this._value; }
    get value() { return this._value; }
}
(function (Leaf) {
    /** class Ref < V > */
    class Ref extends Leafr.Ref {
    }
    Leaf.Ref = Ref;
})(Leaf || (Leaf = {}));
(function (Leaf) {
    /** プリミティブ型シュガー */
    class String extends Leaf {
    }
    Leaf.String = String;
    class Number extends Leaf {
    }
    Leaf.Number = Number;
    class Boolean extends Leaf {
    }
    Leaf.Boolean = Boolean;
    ;
})(Leaf || (Leaf = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGVhZi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3RzLXNyYy9tZWgvbW9kZWwvbGVhZi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWtCLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDckMsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQztBQUd4QixvQkFBb0I7QUFFcEIsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLE1BQU0sRUFBRSxDQUFDO0FBRWxDLE1BQU0sT0FBTyxLQUFZLFNBQVEsS0FBSztJQVNjO0lBUG5ELE1BQU0sQ0FBQyxJQUFJLENBQVMsS0FBc0IsRUFBRSxHQUFxQjtRQUVoRSxPQUFPLEdBQUcsWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLENBQVMsS0FBSyxFQUFFLEdBQUcsQ0FBRSxDQUFDO0lBQ3BFLENBQUM7SUFBQSxDQUFDO0lBRUYsT0FBTztJQUVQLFlBQWEsU0FBMEIsRUFBWSxNQUFVO1FBRTVELEtBQUssQ0FBRSxTQUFTLENBQUUsQ0FBQztRQUYrQixXQUFNLEdBQU4sTUFBTSxDQUFJO0lBRzdELENBQUM7SUFFRCxZQUFZO0lBRVosSUFBVyxDQUFDLEtBQVMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUMxQyxJQUFXLEdBQUcsS0FBUyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQzVDLElBQVcsS0FBSyxLQUFTLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDdkMsR0FBRyxLQUFTLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFFakMsQ0FBRSxTQUFTLENBQUUsQ0FBRSxJQUFRLEVBQUUsT0FBb0M7UUFFbkUs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