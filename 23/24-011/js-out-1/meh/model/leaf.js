import { Exist, _container, _refs } from "./exist.js";
import { Branch } from "./branch.js";
const log = console.log;
/** Leaf Readonly */
export const _setvalue = Symbol();
export class Leafr extends Exist {
    _value;
    static make(container, lol) {
        return lol instanceof Leafr ? lol : new Leafr(container, lol);
    }
    ;
    /**  */
    constructor(container, _value) {
        super(container);
        this._value = _value;
    }
    /** value */
    get v() { return this._value; }
    get val() { return this._value; }
    get value() { return this._value; }
    get() { return this._value; }
    [_setvalue](newv, changer) {
        if (newv === this._value)
            return false;
        const oldv = this._value;
        this._value = newv;
        if (changer != this[_container] && this[_container] instanceof Branch) {
            this[_container].update();
        }
        this[_refs].forEach(ref => {
            (ref instanceof Leafr.Ref)
                && ref._new_value(newv, oldv);
        });
        return true;
    }
}
(function (Leafr) {
    class Ref extends Exist.Ref {
        leafr_acts;
        constructor(refcon, leafr_acts, source) {
            super(refcon, leafr_acts);
            this.leafr_acts = leafr_acts;
            this.source = source;
        }
        _new_source(news, olds) {
            if (news instanceof Leafr)
                this._new_value(news.value);
        }
        _new_value(newv, oldv) {
            this.leafr_acts.new_value?.(newv, oldv);
        }
    }
    Leafr.Ref = Ref;
})(Leafr || (Leafr = {}));
(function (Leafr) {
    /** プリミティブ型シュガー */
    class String extends Leafr {
    }
    Leafr.String = String;
    class Number extends Leafr {
    }
    Leafr.Number = Number;
    class Boolean extends Leafr {
    }
    Leafr.Boolean = Boolean;
    ;
})(Leafr || (Leafr = {}));
/** Leaf RW  */
export class Leaf extends Leafr {
    static make(container, lol) {
        return lol instanceof Leaf ? lol : new Leaf(container, lol);
    }
    ;
    /**  */
    set(newv, changer) {
        return this[_setvalue](newv, changer);
    }
    set v(newv) { this[_setvalue](newv); }
    set val(newv) { this[_setvalue](newv); }
    set value(newv) { this[_setvalue](newv); }
    get v() { return this._value; }
    get val() { return this._value; }
    get value() { return this._value; }
}
(function (Leaf) {
    /** class Ref < V > */
    class Ref extends Leafr.Ref {
    }
    Leaf.Ref = Ref;
})(Leaf || (Leaf = {}));
(function (Leaf) {
    /** プリミティブ型シュガー */
    class String extends Leaf {
    }
    Leaf.String = String;
    class Number extends Leaf {
    }
    Leaf.Number = Number;
    class Boolean extends Leaf {
    }
    Leaf.Boolean = Boolean;
    ;
})(Leaf || (Leaf = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGVhZi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3RzLXNyYy9tZWgvbW9kZWwvbGVhZi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDdEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUNyQyxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO0FBR3hCLG9CQUFvQjtBQUVwQixNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUcsTUFBTSxFQUFFLENBQUM7QUFFbEMsTUFBTSxPQUFPLEtBQVksU0FBUSxLQUFLO0lBU2U7SUFQcEQsTUFBTSxDQUFDLElBQUksQ0FBUyxTQUEyQixFQUFFLEdBQXFCO1FBRXJFLE9BQU8sR0FBRyxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBUyxTQUFTLEVBQUUsR0FBRyxDQUFFLENBQUM7SUFDeEUsQ0FBQztJQUFBLENBQUM7SUFFRixPQUFPO0lBRVAsWUFBYSxTQUEyQixFQUFZLE1BQVU7UUFFN0QsS0FBSyxDQUFFLFNBQVMsQ0FBRSxDQUFDO1FBRmdDLFdBQU0sR0FBTixNQUFNLENBQUk7SUFHOUQsQ0FBQztJQUVELFlBQVk7SUFFWixJQUFXLENBQUMsS0FBUyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQzFDLElBQVcsR0FBRyxLQUFTLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDNUMsSUFBVyxLQUFLLEtBQVMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUN2QyxHQUFHLEtBQVMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUVqQyxDQUFFLFNBQVMsQ0FBRSxDQUFFLElBQVEsRUFBRSxPQUFvQztRQUVuRSxJ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