import { Leaf, leaf, ef, Lian, defs } from "../meh/index.js";
import { sitepub } from "./sitepub_all_utf8.js";
import { Range } from "../range.js";
const log = console.log;
const clip = (value, min, max) => Math.max(min, Math.min(max, value));
const pxRatio = 1000;
// Model //
var Model;
(function (Model) {
    class Map {
        // パラメータ //
        current = new Leaf(null);
        zoom;
        center;
        //  //
        hover = new Leaf(null);
        hoverInfo = new Leaf.String("");
        currentInfo = new Leaf.String("");
        hoverList = new Lian;
        currentList = new Lian;
        scrollCSS = leaf.string("");
        zoomCSS = leaf.string("");
        // 固定値 //
        lat = { max: 45.5132, min: 24.3413 };
        long = { max: 145.8026, min: 123.7798 };
        //  //
        constructor() {
            const rel = () => this.update();
            this.zoom = new Leaf.Number(5, { rel });
            this.center = new Leaf({ lat: 36.0, long: 139.0 }, { rel });
            this.hover.ref(() => this.updateHover());
            this.current.ref((newItem, oldItem) => this.updateCurrent(newItem, oldItem));
            this.hoverList.add(Site.list[555]);
            this.hoverList.add(Site.list[777]);
            this.hoverList.add(Site.list[999]);
            rel();
        }
        update() {
            const scale = this.zoomScale;
            const tlx = -this.longToPx(this.center.value.long) + "px";
            const tly = -this.latToPx(this.center.value.lat) + "px";
            this.scrollCSS.value = `translate( ${tlx}, ${tly} )`;
            this.zoomCSS.value = `scale( ${scale}, ${scale} )`;
        }
        updateHover() {
            const site = this.hover.value;
            this.hoverInfo.value = Site.info(site);
            site && this.hoverList.add(site);
        }
        updateCurrent(newItem, oldItem) {
            this.currentInfo.value = Site.info(newItem);
            oldItem && (oldItem.selected.value = false);
            newItem && (newItem.selected.value = true);
        }
        cssPos(site) {
            const left = this.longToPx(site.long) + "px";
            const top = this.latToPx(site.lat) + "px";
            return { left, top };
        }
        latToPx(lat) { return (this.lat.max - lat) * pxRatio; }
        longToPx(long) { return (long - this.long.min) * pxRatio; }
        get zoomScale() { return Math.pow(10, this.zoom.value / 5 - 2); } // zoom : 0 ~ 5 ~ 10 => scale : 0.01 ~ 0.1 ~ 1
        get scrollstep() {
            const rt = 1 / this.zoomScale / pxRatio;
            log("scrstep", rt);
            return rt;
        }
    }
    Model.Map = Map;
    //
    class Site {
        src;
        selected = leaf.boolean(false);
        constructor(src) {
            this.src = src.split(",");
        }
        get code() { return this.src[0]; }
        get name() { return this.src[1]; }
        get nameR() { return this.src[2]; }
        get lat() { return Number(this.src[3]); }
        get long() { return Number(this.src[4]); }
        get elev() { return Number(this.src[5]); }
        get depth() { return Number(this.src[6]); }
        static info(site) {
            return site && `${site.code} ${site.name} ${site.nameR}` || "-";
        }
        static list = sitepub.split("\n").map(csv => new Site(csv));
    }
    Model.Site = Site;
    ;
    log("sitecount", Site.list.length);
})(Model || (Model = {}));
// UI //
// . site . //
const { div, h2, h3, textarea, p, span } = ef;
const Site = (site, map) => {
    const { left, top } = map.cssPos(site);
    return div({
        class: ["map-site", { selected: site.selected }],
        style: { left, top },
        acts: {
            mouseover() { map.hover.value = site; },
            mousedown(ev) { map.current.value = site; ev.stopPropagation(); },
        },
        actActs: {
            touchstart(ev) { map.current.value = site; ev.preventDefault(); }
        }
    }, div({ class: "map-site-label" }, site.name));
};
class ScrollWork {
    map;
    // scroll //
    recx;
    recy;
    srcmode = "none";
    touchMon = new Leaf.String("");
    mousemon = new Leaf.String("");
    docmousemon = new Leaf.String("");
    constructor(map) {
        this.map = map;
        this.wheelzoom = map.zoom.value;
        document.addEventListener("mousemove", this.docmousemove, { passive: false });
    }
    mon(name, x, y) {
        this.mousemon.value = `${name} ${x} ${y}`;
    }
    mousedown = (ev) => {
        if (ev.buttons & 1) {
            this.recpos(ev.screenX, ev.screenY, ev);
            this.srcmode = "mouse";
        }
        this.mon("down", ev.screenX, ev.screenY);
    };
    docmousemove = (ev) => {
        this.mon("move", ev.screenX, ev.screenY);
        if (!(ev.buttons & 1))
            this.srcmode = "none";
        if (this.srcmode == "mouse" && ev.buttons & 1)
            this.scroll(ev.screenX, ev.screenY, ev);
        this.docmousemon.value = `move ${ev.screenX} ${ev.screenY} ${ev.buttons}`;
    };
    mouseup = (ev) => {
        this.mon("up  ", ev.screenX, ev.screenY);
    };
    touchstart = (ev) => {
        const t0 = ev.touches[0];
        this.recpos(t0.screenX, t0.screenY, ev);
        this.touchMon.value = `start ${ev.touches.length} ${t0.screenX} ${t0.screenY} }`;
    };
    touchmove = (ev) => {
        const t0 = ev.touches[0];
        this.scroll(t0.screenX, t0.screenY, ev);
        this.touchMon.value = `move  ${ev.touches.length} ${t0.screenX} ${t0.screenY} }`;
    };
    touchend = (ev) => {
        const t0 = ev.touches[0];
        this.touchMon.value = `end   ${ev.touches.length} }`;
    };
    //  //
    recpos(screenX, screenY, ev) {
        this.recx = screenX;
        this.recy = screenY;
        ev.preventDefault();
    }
    scroll(screenX, screenY, ev) {
        const center = this.map.center.value;
        const stepscale = this.map.scrollstep;
        const deltaX = this.delta(screenX, this.recx);
        const deltaY = this.delta(screenY, this.recy);
        this.recpos(screenX, screenY, ev);
        const long = clip(center.long - deltaX * stepscale, this.map.long.min, this.map.long.max);
        const lat = clip(center.lat + deltaY * stepscale, this.map.lat.min, this.map.lat.max);
        this.map.center.value = { lat, long };
    }
    delta(mouse, rec) {
        return rec != null ? (mouse - rec) : 0;
    }
    // zoom //
    wheelzoom;
    wheelMon = new Leaf.String("");
    wheel = (ev) => {
        this.wheelMon.value = `${ev.deltaX} ${ev.deltaY}`;
        const zoom = this.wheelzoom + ev.deltaY * -0.05;
        this.wheelzoom = Math.min(10, Math.max(0, zoom));
        this.map.zoom.value = Math.round(this.wheelzoom);
        ev.preventDefault();
    };
}
// .. ui .. //
const MapFrame = (model, scrzoom) => {
    const content = div({
        class: "map-content",
        style: { transform: model.scrollCSS }
    }, ...Model.Site.list.map(siteInfo => Site(siteInfo, model)));
    const zoomFrame = div({
        class: "map-zoom",
        style: { transform: model.zoomCSS }
    }, content);
    const { mousedown, mouseup, touchstart, touchmove, touchend, wheel } = scrzoom;
    return div({
        class: "map-frame",
        acts: { mouseup, touchend },
        actActs: { wheel, mousedown, touchstart, touchmove, },
    }, div(), div(), div(), zoomFrame);
};
// main ui //
export const Map = () => {
    const model = new Model.Map;
    const lianMon = new Leaf.String("");
    const scrzoom = new ScrollWork(model);
    model.hoverList.ref(() => {
        const lian = model.hoverList;
        const list = lian.slice(-130).map(site => `${site.name}`);
        lianMon.value = "" + lian.length + " " + list.join(" ");
    });
    return div({ class: "map applet" }, h2("EQ Site Map"), div(div({ class: "map-site-info" }, model.currentInfo), MapFrame(model, scrzoom), div({ class: "map-site-info" }, model.hoverInfo), div(Range.UI({ title: "拡大", value: model.zoom, max: 10 }))), div(div("d.mouse", " ", scrzoom.docmousemon), div("mouse", " ", scrzoom.mousemon), div("touch", " ", scrzoom.touchMon), div("wheel", " ", scrzoom.wheelMon)), div(h3("ホバー履歴"), div(
    //defs.ap( model.hoverList, item => { log( item.code ); return span( "span" ) } ),
    defs.ap(model.hoverList, item => item.name + " "), defs.ap([1, 2, 3], item => span(item))), textarea({ props: { value: lianMon }, style: { width: "100%", height: "20em", lineHeight: "1.4em" } })));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdHMtc3JjL2VxL21hcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzdELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3BDLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7QUFFeEIsTUFBTSxJQUFJLEdBQUcsQ0FBRSxLQUFjLEVBQUUsR0FBWSxFQUFFLEdBQVksRUFBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBRSxHQUFHLEVBQUUsS0FBSyxDQUFFLENBQUUsQ0FBQztBQUd2RyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUM7QUFFckIsV0FBVztBQUVYLElBQVUsS0FBSyxDQXdIZDtBQXhIRCxXQUFVLEtBQUs7SUFFZCxNQUFhLEdBQUc7UUFFZixXQUFXO1FBRVgsT0FBTyxHQUFHLElBQUksSUFBSSxDQUFtQixJQUFJLENBQUUsQ0FBQztRQUM1QyxJQUFJLENBQWU7UUFDbkIsTUFBTSxDQUFvQjtRQUUxQixNQUFNO1FBRU4sS0FBSyxHQUFHLElBQUksSUFBSSxDQUFtQixJQUFJLENBQUUsQ0FBQztRQUMxQyxTQUFTLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFFLEVBQUUsQ0FBRSxDQUFDO1FBQ2xDLFdBQVcsR0FBRyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUUsRUFBRSxDQUFFLENBQUM7UUFFcEMsU0FBUyxHQUFHLElBQUksSUFBYSxDQUFFO1FBQy9CLFdBQVcsR0FBRyxJQUFJLElBQWEsQ0FBRTtRQUVqQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1B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